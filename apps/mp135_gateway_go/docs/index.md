# CAN Gateway Application - æŠ€è¡“ä»•æ§˜æ›¸

![Project Status](https://img.shields.io/badge/status-in%20development-yellow)
![Go Version](https://img.shields.io/badge/Go-1.21+-00ADD8?logo=go&logoColor=white)
![Platform](https://img.shields.io/badge/platform-M5Stack%20CoreMP135-orange)

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€**M5Stack CoreMP135**ã‚’ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¨ã—ã¦åˆ©ç”¨ã—ã€CANãƒã‚¹é€šä¿¡ã‚’ä»‹ã—ã¦ç”£æ¥­æ©Ÿå™¨ã‚„è»Šä¸¡ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã—ã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¸è»¢é€ã™ã‚‹IoTã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

### ä¸»ãªç‰¹å¾´

- âš¡ **é«˜é€Ÿå‡¦ç†**: Goè¨€èªã®goroutineã«ã‚ˆã‚‹ä¸¦è¡Œå‡¦ç†ã§500 frames/secã®å‡¦ç†èƒ½åŠ›
- ğŸ”„ **ãƒ—ãƒ­ãƒˆã‚³ãƒ«å¤‰æ›**: CAN â†’ MQTT/HTTP/WebSocketã¸ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªå¤‰æ›
- ğŸ›¡ï¸ **å …ç‰¢æ€§**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã€Dead Letter Queueå¯¾å¿œ
- ğŸ“Š **ç›£è¦–**: Prometheuså¯¾å¿œãƒ¡ãƒˆãƒªã‚¯ã‚¹ã€ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯API
- ğŸ”§ **æŸ”è»Ÿãªè¨­å®š**: YAMLè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚‹å‹•çš„ãªå‹•ä½œå¤‰æ›´

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```mermaid
graph LR
    A[ç”£æ¥­æ©Ÿå™¨/è»Šä¸¡] -->|CAN Bus| B[M5Stack CoreMP135<br/>CANã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤]
    B -->|MQTT| C[ã‚¯ãƒ©ã‚¦ãƒ‰<br/>IoTãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ]
    B -->|HTTP| D[REST API<br/>ã‚µãƒ¼ãƒãƒ¼]
    B -->|WebSocket| E[ç›£è¦–UI<br/>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰]
    
    style A fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style B fill:#4ecdc4,stroke:#099268,color:#fff
    style C fill:#feca57,stroke:#ee9a00,color:#333
    style D fill:#feca57,stroke:#ee9a00,color:#333
    style E fill:#feca57,stroke:#ee9a00,color:#333
```

## ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

### 1. è»Šä¸¡ãƒ‡ãƒ¼ã‚¿åé›†

è»Šä¸¡ã®ECUï¼ˆEngine Control Unitï¼‰ã‹ã‚‰ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åé›†ï¼š

- ã‚¨ãƒ³ã‚¸ãƒ³å›è»¢æ•°ï¼ˆRPMï¼‰
- è»Šé€Ÿ
- ç‡ƒæ–™æ¶ˆè²»é‡
- ã‚¨ãƒ³ã‚¸ãƒ³æ¸©åº¦
- ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆDTCï¼‰

### 2. ç”£æ¥­æ©Ÿå™¨ç›£è¦–

è£½é€ ãƒ©ã‚¤ãƒ³ã‚„é‡æ©Ÿã®ç¨¼åƒçŠ¶æ…‹ã‚’ç›£è¦–ï¼š

- ç¨¼åƒæ™‚é–“
- ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆæ¸©åº¦ã€åœ§åŠ›ã€æŒ¯å‹•ï¼‰
- ã‚¢ãƒ©ãƒ¼ãƒ æƒ…å ±
- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå…†æ¤œçŸ¥

### 3. å»ºè¨­æ©Ÿæ¢°ãƒ•ãƒªãƒ¼ãƒˆç®¡ç†

è¤‡æ•°ã®å»ºè¨­æ©Ÿæ¢°ã®ä½ç½®æƒ…å ±ãƒ»ç¨¼åƒçŠ¶æ³ã‚’ä¸€å…ƒç®¡ç†ï¼š

- GPSä½ç½®æƒ…å ±é€£æº
- ç‡ƒæ–™æ®‹é‡ç›£è¦–
- ç¨¼åƒæ™‚é–“é›†è¨ˆ
- é éš”è¨ºæ–­

## æŠ€è¡“ä»•æ§˜ã‚µãƒãƒªãƒ¼

| é …ç›® | ä»•æ§˜ |
|-----|------|
| **é–‹ç™ºè¨€èª** | Go 1.21+ |
| **ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢** | M5Stack CoreMP135 (ARM Cortex-A7, 512MB RAM) |
| **OS** | Linux (Buildroot) |
| **CANã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹** | SocketCAN (/dev/can0) |
| **å¯¾å¿œãƒ—ãƒ­ãƒˆã‚³ãƒ«** | MQTT 3.1.1/5.0, HTTP/1.1, WebSocket |
| **å‡¦ç†æ€§èƒ½** | 500 CAN frames/sec |
| **ãƒ‡ãƒ¼ã‚¿é…å»¶** | <10ms (P95) |

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹æˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ãƒˆã¯ã€ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š

### ğŸ“ [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸](architecture.md)

ã‚·ã‚¹ãƒ†ãƒ ã®å…¨ä½“è¨­è¨ˆã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã€ä¸¦è¡Œå‡¦ç†ãƒ¢ãƒ‡ãƒ«ãªã©ã®è©³ç´°è¨­è¨ˆæƒ…å ±ã‚’è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚

**å«ã¾ã‚Œã‚‹å†…å®¹:**

- ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦ãƒ»æŠ€è¡“é¸å®šç†ç”±
- å…¨ä½“æ§‹æˆå›³ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ
- ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾©
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ
- æ€§èƒ½è¦ä»¶

### ğŸ”Œ [APIä»•æ§˜](api.md)

ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãŒæä¾›ã™ã‚‹å„ç¨®APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã€èªè¨¼æ–¹æ³•ãªã©ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

### ğŸš€ [é‹ç”¨ã‚¬ã‚¤ãƒ‰](operations.md)

ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã€ç›£è¦–ãƒ»ãƒ­ã‚°ç®¡ç†ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ãƒªã‚«ãƒãƒªãªã©ã®é‹ç”¨æ‰‹é †ã‚’è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚

### ğŸ’» [é–‹ç™ºã‚¬ã‚¤ãƒ‰](development.md)

é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã€ãƒ†ã‚¹ãƒˆæ–¹æ³•ã€ãƒ“ãƒ«ãƒ‰æ‰‹é †ã€ãƒ‡ãƒãƒƒã‚°æ–¹æ³•ãªã©ã®é–‹ç™ºè€…å‘ã‘æƒ…å ±ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### å‰ææ¡ä»¶

```bash
# Go 1.21ä»¥ä¸Š
go version

# M5Stack CoreMP135ã¸ã®æ¥ç¶š
ssh root@<M5Stack_IP>
```

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

=== "ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ«ãƒ‰"

    ```bash
    # ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
    git clone https://github.com/tinayla696/mp135_gateway_go.git
    cd mp135_gateway_go
    
    # ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    go mod download
    
    # ãƒ“ãƒ«ãƒ‰
    go build -o bin/can_gateway ./cmd/gateway/main.go
    
    # å®Ÿè¡Œ
    ./bin/can_gateway -config configs/config.yaml
    ```

=== "ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ« (M5Stackç”¨)"

    ```bash
    # ARM64å‘ã‘ãƒ“ãƒ«ãƒ‰
    GOOS=linux GOARCH=arm64 go build \
      -ldflags="-s -w" \
      -o bin/can_gateway_arm64 \
      ./cmd/gateway/main.go
    
    # ãƒ‡ãƒã‚¤ã‚¹ã¸è»¢é€
    scp bin/can_gateway_arm64 root@<M5Stack_IP>:/usr/local/bin/can_gateway
    scp configs/config.yaml root@<M5Stack_IP>:/etc/can_gateway/
    
    # SSHæ¥ç¶šã—ã¦èµ·å‹•
    ssh root@<M5Stack_IP>
    can_gateway -config /etc/can_gateway/config.yaml
    ```

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¾‹

```yaml title="configs/config.yaml"
can:
  interface: "can0"
  baudrate: 500000

mqtt:
  broker: "ssl://mqtt.example.com:8883"
  client_id: "can-gateway-001"
  topic_prefix: "vehicle/can"
  qos: 1

filter:
  rules_file: "./configs/filter_rules.json"

logging:
  level: "info"
  format: "json"
```

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

### ç¾åœ¨ã®é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

!!! info "Phase 1: åŸºæœ¬æ©Ÿèƒ½å®Ÿè£… (é€²è¡Œä¸­)"
    - [x] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ è¨­è¨ˆ
    - [x] ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ
    - [ ] CAN Readerå®Ÿè£…
    - [ ] ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å®Ÿè£…
    - [ ] MQTT Publisherå®Ÿè£…
    - [ ] HTTP Clientå®Ÿè£…
    - [ ] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ

### ä»Šå¾Œã®äºˆå®š

!!! note "Phase 2: é«˜åº¦ãªæ©Ÿèƒ½ (è¨ˆç”»ä¸­)"
    - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ°¸ç¶šåŒ–
    - ãƒ«ãƒ¼ãƒ«ã‚¨ãƒ³ã‚¸ãƒ³
    - OTAã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæ©Ÿèƒ½
    - Prometheus Exporter

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯[MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹](https://opensource.org/licenses/MIT)ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

## è²¢çŒ®

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ­“è¿ã—ã¾ã™ï¼è©³ç´°ã¯[é–‹ç™ºã‚¬ã‚¤ãƒ‰](development.md)ã‚’ã”è¦§ãã ã•ã„ã€‚

## ã‚µãƒãƒ¼ãƒˆ

è³ªå•ã‚„å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€[GitHubã®Issues](https://github.com/tinayla696/mp135_gateway_go/issues)ã§ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚

---

!!! tip "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°æ—¥"
    æœ€çµ‚æ›´æ–°: 2026å¹´1æœˆ3æ—¥